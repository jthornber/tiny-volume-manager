#!/usr/bin/env ruby

require 'lib/disk-units'
require 'lib/log'
require 'lib/tvm/tvm_api'
require 'lib/tvm/command_line'
require 'lib/tvm/dispatcher'

include DiskUnits
include Log
include TVM

#----------------------------------------------------------------

open_log("./tvm.log")

METADATA_FILE='./volumes.yaml'

metadata = YAMLMetadata.new(METADATA_FILE)
vm = VolumeManager.new(metadata)

# We're alway in an implicit transaction
vm.begin unless metadata.in_transaction?

dispatcher = Dispatcher.new(vm)
parse_command_line(dispatcher, *ARGV)

metadata.persist

#----------------------------------------------------------------

exit 0

